#!/bin/bash

echo "üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ DNS –∫—ç—à–∞"
echo "========================"

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è DIG –∑–∞–ø—Ä–æ—Å–∞
dig_test() {
    local domain=$1
    local port=${2:-5355}
    
    echo ""
    echo "üì° DIG –∑–∞–ø—Ä–æ—Å –¥–ª—è $domain"
    echo "–í—Ä–µ–º—è: $(date)"
    
    dig @127.0.0.1 -p $port $domain +noall +answer +stats
    
    echo ""
    echo "---"
    sleep 2
}

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ DNS —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –ø–æ—Ä—Ç—É 5355..."
if ! nc -z 127.0.0.1 5355; then
    echo "‚ùå DNS —Å–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 5355"
    echo "–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä: go run cmd/main.go -port 5355"
    exit 1
fi

# –¢–µ—Å—Ç–∏—Ä—É–µ–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
echo "‚úÖ DNS —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω"
echo ""

# –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–º)
echo "1Ô∏è‚É£ –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–º):"
dig_test "example.com" 5355

# –í—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±—ã—Å—Ç—Ä—ã–º –∏–∑-–∑–∞ –∫—ç—à–∞)
echo "2Ô∏è‚É£ –í—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±—ã—Å—Ç—Ä—ã–º –∏–∑-–∑–∞ –∫—ç—à–∞):"
dig_test "example.com" 5355

# –¢—Ä–µ—Ç–∏–π –∑–∞–ø—Ä–æ—Å (–µ—â—ë –±—ã—Å—Ç—Ä–µ–µ)
echo "3Ô∏è‚É£ –¢—Ä–µ—Ç–∏–π –∑–∞–ø—Ä–æ—Å (–µ—â—ë –±—ã—Å—Ç—Ä–µ–µ):"
dig_test "example.com" 5355

echo "‚ú® –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!"
echo "–ï—Å–ª–∏ –∫—ç—à —Ä–∞–±–æ—Ç–∞–µ—Ç, –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –¥–æ–ª–∂–Ω–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–º–µ–Ω—å—à–∏—Ç—å—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞."